1. Introduction
===============

This folder contains various projects containing code pertaining to the SeaSlug.

2. Requirements
===============
Software:
 * MATLAB/Simulink
     * Instrument control toolkit/blockset
     * Aerospace toolkit/blockset
     * Embedded coder, MATLAB coder, Simulink coder
     * [uSimLib](https://github.com/Susurrus/MicroSimulink-Library) and in the path
     * [Lubin Kerhuel's Simulink blockset](http://www.kerhuel.eu/wiki/Simulink_-_Embedded_Target_for_PIC) and in the path
     * Added to the path: `/Code/Libs/MATLAB`, `/Code/primary_node`, `/Code/basic_model`, `/Code/Scripts/MATLAB`
 * Microchip's MPLAB X (newest)
 * Microchip's XC16 (newest)

Hardware
 * CANode (contact asl.soe.ucsc.edu) with dsPIC33EP256MC502

3. Projects
===========

basic_model
-----------
Implements several simulator models along with Plant.mdl, the plant used for simulating the boat. Utilizes a crude inverse-bicycle model. To run these `/Code/primary_node/` must be on the MATLAB path. The `/Code/basic_model` folder must also be on the path for opening these models when the current working directory is not this folder.

HIL_node
--------
Provides a CAN interface with the basic_model simulator via a serial connection (that needs a serial-to-UDP bridge). Emulates many of the other nodes in order to fool the primary_node into normal operations. Written in all C.

Imu_node
--------
Provides a CAN interface to the Tokimec VSAS-2GM IMU+GPS interfacing over RS232. Broadcasts all incoming IMU data via CAN using the same data packets the VSAS-2GM would normally use over CAN. Utilizes Lubin's blockset for generating C code from Simulink.

Libs
----
Contains all shared code used by this project sorted by language. Also contains input files for some libraries, like MAVLink.
 
Paper_sim
---------
A simulation model built off of Pï¿½rez and Blanke 2002. Relies on many coefficients that need to be found experimentally, so it's not very accurate right now. Hopefully this will be the approach taken for the final boat model.

Power_node
----------
This runs on a CAN node and translates the sensor values for the current/voltage sensor on the main power rail into CAN messages. These are then processed by the primary controller node. Written entirely in C.

Primary_node
------------
This node implements the same controller as the basic_model simulator. It has an onboard interface to an analog power sensor, but otherwise all vessel communications are done over CAN. Its groundstation output is via the UART connector on the CANode.

Compiling this code involves generating the code for controller.mdl using Simulink (requires github.com/Susurrus/MicroSimulink-Library). Then all necessary C code is compiled using MPLAB X.

Additional requirements for compiling this node:
 * The XC16's `stdint.h` file should be duplicated as the `inttypes.h` file in order for MAVLink to compile.
 * It requires a SeaSlug-compiled MAVLink library, generated by the mavgen.py tool from github.com/mavlink/mavlink using the .xml file in `/Code/Libs/MAVLink`.
 * A heap size of 1024 bytes should be specified when the project is compiled in MPLAB X.

RC_node
-------
Provides a CAN interface for an RC receiver using a CANode. It also has a custom shield providing a plug-in interface for Spektrum's AR6100e receiver. Relies on Lubin's blockset for code generation.

Rudder_node
----------------
Integrates with the rudder (a stepper motor driver board, potentiometer position sensor, and port/starbord limit switches) and provides a CAN interface to it. Handles calibration as well. This has the same compilation requirements as the RC node.
